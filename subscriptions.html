<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence &#x2013; Subscriptions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="running-eiffel-intelligence.html"  title="Running Eiffel Intelligence">Running Eiffel Intelligence</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                                  <li>      <a href="docker.html"  title="Running in Docker">Running in Docker</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="subscriptions.html"  title="Understanding subscriptions">Understanding subscriptions</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="subscription-with-REST-POST-notification.html"  title="Subscription with REST POST notification">Subscription with REST POST notification</a>
</li>
                                  <li>      <a href="triggering-jenkins-jobs.html"  title="HTTP POST notification to trigger parameterized Jenkins jobs">HTTP POST notification to trigger parameterized Jenkins jobs</a>
</li>
                                  <li>      <a href="subscription-with-email-notification.html"  title="Subscription with Email notification">Subscription with Email notification</a>
</li>
                                  <li>      <a href="step-by-step-subscription-notification.html"  title="Step-by-step Subscription Notification">Step-by-step Subscription Notification</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="rules.html"  title="Understanding rules">Understanding rules</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="merge-resolver-rules.html"  title="Merge Resolver Rules">Merge Resolver Rules</a>
</li>
                                  <li>      <a href="history-rules.html"  title="History Rules">History Rules</a>
</li>
                                  <li>      <a href="example-rules.html"  title="Example Rules">Example Rules</a>
</li>
                                  <li>      <a href="mapping-rules-to-aggregations.html"  title="Mapping Rules To Aggregations">Mapping Rules To Aggregations</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="step-by-step-aggregation.html"  title="Step-by-step aggregation">Step-by-step aggregation</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="artifact-created-event-aggregation.html"  title="ArtifactCreatedEvent aggregation">ArtifactCreatedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-triggered-event-aggregation.html"  title="TestCaseTriggeredEvent aggregation">TestCaseTriggeredEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-started-event-aggregation.html"  title="TestCaseStartedEvent aggregation">TestCaseStartedEvent aggregation</a>
</li>
                                  <li>      <a href="test-case-finished-event-aggregation.html"  title="TestCaseFinishedEvent aggregation">TestCaseFinishedEvent aggregation</a>
</li>
                                  <li>      <a href="artifact-published-event-aggregation.html"  title="ArtifactPublishedEvent aggregation">ArtifactPublishedEvent aggregation</a>
</li>
                                  <li>      <a href="confidence-level-modified-event-aggregation.html"  title="ConfidenceLevelModifiedEvent">ConfidenceLevelModifiedEvent</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="REST-API.html"  title="REST API">REST API</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="query.html"  title="Query">Query</a>
</li>
                                  <li>      <a href="running-rules-on-objects.html"  title="Running rules on objects">Running rules on objects</a>
</li>
                                  <li>      <a href="authentication.html"  title="Authentication">Authentication</a>
</li>
                                  <li>      <a href="subscription-API.html"  title="Subscriptions">Subscriptions</a>
</li>
                                  <li>      <a href="status.html"  title="Status">Status</a>
</li>
                                  <li>      <a href="download-files.html"  title="Download files">Download files</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="compatibility.html"  title="Compatibility">Compatibility</a>
</li>
                  
                      <li>      <a href="known-limitations.html"  title="Known limitations">Known limitations</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Subscriptions</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-09-25</li>
              <li id="projectVersion" class="pull-right">
                    Version: 2.0.0
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                                                                                    
      <li>
  
                          <a href="running-eiffel-intelligence.html" title="Running Eiffel Intelligence">
          <span class="icon-chevron-right"></span>
        Running Eiffel Intelligence</a>
                  </li>
                                                                                                                            
      <li class="active">
  
            <a href="#"><span class="icon-chevron-down"></span>Understanding subscriptions</a>
                  <ul class="nav nav-list">
                    
      <li>
  
                          <a href="subscription-with-REST-POST-notification.html" title="Subscription with REST POST notification">
          <span class="none"></span>
        Subscription with REST POST notification</a>
            </li>
                    
      <li>
  
                          <a href="triggering-jenkins-jobs.html" title="HTTP POST notification to trigger parameterized Jenkins jobs">
          <span class="none"></span>
        HTTP POST notification to trigger parameterized Jenkins jobs</a>
            </li>
                    
      <li>
  
                          <a href="subscription-with-email-notification.html" title="Subscription with Email notification">
          <span class="none"></span>
        Subscription with Email notification</a>
            </li>
                    
      <li>
  
                          <a href="step-by-step-subscription-notification.html" title="Step-by-step Subscription Notification">
          <span class="none"></span>
        Step-by-step Subscription Notification</a>
            </li>
              </ul>
        </li>
                                                                                                                        
      <li>
  
                          <a href="rules.html" title="Understanding rules">
          <span class="icon-chevron-right"></span>
        Understanding rules</a>
                  </li>
                                                                                                                                                            
      <li>
  
                          <a href="step-by-step-aggregation.html" title="Step-by-step aggregation">
          <span class="icon-chevron-right"></span>
        Step-by-step aggregation</a>
                  </li>
                                                                                                                                                            
      <li>
  
                          <a href="REST-API.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                
      <li>
  
                          <a href="compatibility.html" title="Compatibility">
          <span class="none"></span>
        Compatibility</a>
            </li>
                
      <li>
  
                          <a href="known-limitations.html" title="Known limitations">
          <span class="none"></span>
        Known limitations</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Subscriptions</h1>
<p>When the desired Eiffel events have been aggregated a user would like to be notified and there is possibility to register a subscription that will be run on each save of an aggregated object in the database.</p>
<p>Whenever an aggregated object is created or modified, it is evaluated against all registered subscriptions to find out whether the aggregated object meets any subscription requirements. If it fulfills a subscription requirement then a notification is sent to the subscriber as specified in that subscription. For further explanation of the process, <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/step-by-step-subscription-notification.md">consider the following example</a>.</p>
<div class="section">
<div class="section">
<h3><a name="Adding_subscriptions"></a>Adding subscriptions</h3>
<p>It is possible to add subscriptions using the <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/add-subscription.md">Eiffel Intelligence front-end GUI</a>. It is also possible to manage subscriptions <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-API.md">using the REST API</a>.</p></div>
<div class="section">
<h3><a name="Adding_comments_inside_subscription"></a>Adding comments inside subscription</h3>
<p>It is possible for users to add comments, at any level, in subscriptions. These comments should be a new field in the given subscription, following the json format.</p>

<div>
<div>
<pre class="source">{
    &quot;description&quot;: &quot;It is my comment&quot;
}
</pre></div></div>
</div>
<div class="section">
<h3><a name="Types_of_notifications_for_subscriptions"></a>Types of notifications for subscriptions</h3>
<p>Today Eiffel Intelligence supports notifications by email or by sending a HTTP POST request. It is also possible to pass parameters with the HTTP request. Example subscriptions with different types of notification can be found in the below links:</p>
<ul>

<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-with-REST-POST-notification.md">Subscription with HTTP POST notification</a></li>
<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/triggering-jenkins-jobs.md">Subscription with HTTP POST notification to trigger parameterized Jenkins job</a></li>
<li><a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/subscription-with-email-notification.md">Subscription with E-mail notification</a></li>
</ul></div>
<div class="section">
<h3><a name="Writing_requirements_and_conditions"></a>Writing requirements and conditions</h3>
<p>When writing subscription requirements, they are referencing the structure of the aggregated object which Eiffel Intelligence will create based on the rules it was configured with. It is therefore important to know what the aggregated object will look like when writing the conditions.</p>
<p>In order for a subscription to be triggered, the subscription requirement needs to be fulfilled. The requirements can be grouped with one or several conditions inside them. Each requirement group is separated with an &#x2018;OR&#x2019;, while the conditions inside a requirement are connected with an &#x2018;AND&#x2019;. This means all the conditions in a requirement group must be fulfilled, while only one of the requirement groups needs to be fulfilled, for the subscription to trigger. Subscription templates <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/tree/master/src/main/resources/templates">can be found here</a>.</p>
<p>We will go through how to write some example requirements in subscriptions based on the below aggregated object. Conditions in subscriptions are written with <a class="externalLink" href="http://jmespath.org/specification.html">JMESPath syntax</a>. Below is a document containing an aggregated object. In addition to the extracted content from Eiffel events, Eiffel Intelligence has added an extra _id key with the value of the start event. This _id serves as an index in mongo DB and speeds up searches.</p>

<div>
<div>
<pre class="source">{
        &quot;_id&quot; : &quot;df4cdb42-1580-4cff-b97a-4d0faa9b2b22&quot;,
        &quot;fileInformation&quot; : [
            {
                &quot;extension&quot; : &quot;war&quot;,
                &quot;classifier&quot; : &quot;&quot;
            }
        ],
        &quot;artifactCustomData&quot; : [],
        &quot;buildCommand&quot; : &quot;trigger&quot;,
        &quot;identity&quot; : &quot;pkg:maven/com.mycompany.myproduct/artifact-name@2.1.7&quot;,
        &quot;confidenceLevels&quot; : [
            {
                &quot;eventId&quot; : &quot;e3be0cf8-2ebd-4d6d-bf5c-a3b535cd084e&quot;,
                &quot;name&quot; : &quot;dummy_1_stable&quot;,
                &quot;time&quot; : 1521452400324,
                &quot;value&quot; : &quot;SUCCESS&quot;
            }
        ],
        &quot;TemplateName&quot; : &quot;ARTIFACT_1&quot;,
        &quot;id&quot; : &quot;df4cdb42-1580-4cff-b97a-4d0faa9b2b22&quot;,
        &quot;time&quot; : 1521452368194,
        &quot;type&quot; : &quot;EiffelArtifactCreatedEvent&quot;,
        &quot;publications&quot; : [
            {
                &quot;eventId&quot; : &quot;2acd348d-05e6-4945-b441-dc7c1e55534e&quot;,
                &quot;locations&quot; : [
                    {
                        &quot;type&quot; : &quot;NEXUS&quot;,
                        &quot;uri&quot; : &quot;http://host:port/path&quot;
                    }
                ],
                &quot;time&quot; : 1521452368758
            }
        ]
}
</pre></div></div>

<p>Let&#x2019;s say we need a subscription which is triggered on when an artifact has been published to a location of type &#x201c;NEXUS&#x201d;. This subscription wants to listen for when an Eiffel ArtifactPublished event is aggregated by Eiffel Intelligence.</p>
<p>It is possible to use <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence/blob/master/wiki/markdown/rules.md#What-is-JMESPath?">JMESPath expressions</a> in the conditions of a subscription. We can write a requirement in the subscription with the condition to check for the data of interest. In this case, it is a JSON object in the list of locations containing the key &#x201c;type&#x201d; and value &#x201c;NEXUS&#x201d;. This could be expressed like below:</p>

<div>
<div>
<pre class="source">publications[?locations[?type=='NEXUS']]
</pre></div></div>

<p>It is important to note, when writing conditions the expression starts inside the aggregated object. This means we only have to traverse the JSON structure inside the aggregated object.</p>
<p>If we want to trigger a subscription based on when an artifact has reached the confidence level of &#x2018;SUCCESS&#x2019; we can write the below expression for our condition:</p>

<div>
<div>
<pre class="source">confidenceLevels[?name=='dummy_1_stable'] &amp;&amp; confidenceLevels[?value=='SUCCESS']
</pre></div></div>

<p>These two conditions check both that the artifact name is the right one, and that the confidence level is what we are looking for.</p></div>
<div class="section">
<h3><a name="Repeat_handling"></a>Repeat handling</h3>
<p>See in the frontend documentation <a class="externalLink" href="https://github.com/eiffel-community/eiffel-intelligence-frontend/blob/master/wiki/markdown/add-subscription.md">here</a></p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
